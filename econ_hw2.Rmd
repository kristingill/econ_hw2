---
title: "Econ HW2"
author: "Kristin Gill and Alyssa Kibbe"
date: "4/14/2021"
output: 
   html_document:
     code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(janitor)
library(here)
library(patchwork)
```

```{r}
# read in the data
water_data <- read_csv(here("data", "HW2_Water.csv")) %>% 
  clean_names()
```

## 1. 
### Agriculture
P = 1.9 + 0.51(abatement)
```{r}
ggplot(data = water_data, aes(x = reduced_water_use_abatement,
                              y = mc_agriculture)) +
  geom_line(colour = "green") +
  labs(x = "Abatement (Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Agriculture Marginal Cost of Water Use Abatement") +
  theme_minimal() +
  geom_smooth(method = "lm",
              color = "black",
              size = 0.5,
              fill = "gray10",
              alpha = 0.5) +
  ggpubr::stat_regline_equation(label.x = 115, label.y = 0)
```

### Meat
P = 9.5 + 0.38(abatement)
```{r}
ggplot(data = water_data, aes(x = reduced_water_use_abatement,
                              y = mc_meat)) +
  geom_line(colour = "red") +
  labs(x = "Abatement (Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Meat Marginal Cost of Water Use Abatement") +
  theme_minimal() +
  geom_smooth(method = "lm",
              color = "black",
              size = 0.5,
              fill = "gray10",
              alpha = 0.5) +
  ggpubr::stat_regline_equation(label.x = 115, label.y = 0)
```


### Industrial
P = -27 + 1.1(abatement)
```{r}
ggplot(data = water_data, aes(x = reduced_water_use_abatement,
                              y = mc_industrial)) +
  geom_line(colour = "purple") +
  labs(x = "Abatement (Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Inudustrial Marginal Cost of Water Use Abatement") +
  theme_minimal() +
  geom_smooth(method = "lm",
              color = "black",
              size = 0.5,
              fill = "gray10",
              alpha = 0.5) +
  ggpubr::stat_regline_equation(label.x = 115, label.y = 0)
```


### Urban
P = -14 + 0.6(abatement)
```{r}
ggplot(data = water_data, aes(x = reduced_water_use_abatement,
                              y = mc_urban)) +
  geom_line(colour = "blue") +
  labs(x = "Abatement (Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Urban Marginal Cost of Water Use Abatement") +
  theme_minimal() +
  geom_smooth(method = "lm",
              color = "black",
              size = 0.5,
              fill = "gray10",
              alpha = 0.5) +
  ggpubr::stat_regline_equation(label.x = 115, label.y = 0)
```

### All Together
```{r}
#combined graphs
og_data <- ggplot() +
  geom_line(data = water_data, aes(x = reduced_water_use_abatement,y = mc_urban, color = "blue"), show.legend = FALSE) +
  geom_line(data = water_data, aes(x = reduced_water_use_abatement, y = mc_industrial, color = "black"), show.legend = FALSE) +
  geom_line(data = water_data, aes(x = reduced_water_use_abatement, y=mc_meat, color = "red"), show.legend = FALSE) +
  geom_line(data = water_data, aes(x = reduced_water_use_abatement, y=mc_agriculture, color = "green"), show.legend = FALSE) +
  labs(x = "Abatement (Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Marginal Cost of Water Use Abatement",
       color = "Sector") +
  theme_minimal() +
  scale_x_continuous(limit = c(0,150)) +
  scale_color_manual(labels = c("Industrial", "Urban", "Agriculture", "Meat"), values = c("black", "blue", "green", "red"))

# is this what they are asking for?
ag_df <- data.frame(abatement = seq.int(from = 0, to = 170)) %>% 
  mutate(price = 1.9 + (0.51*abatement))

meat_df <- data.frame(abatement = seq.int(from = 0, to = 200)) %>% 
  mutate(price = 9.5 + (0.38*abatement))

industrial_df <- data.frame(abatement = seq.int(from = 0, to = 230)) %>% 
  mutate(price = -27 + (1.1*abatement))

urban_df <- data.frame(abatement = seq.int(from = 0, to = 300)) %>% 
  mutate(price = -14 + (0.6*abatement))

reg_data <- ggplot() +
  geom_line(data = urban_df, aes(x = abatement, y = price, color = "blue")) +
  geom_line(data = industrial_df, aes(x = abatement, y = price, color = "black")) +
  geom_line(data = meat_df, aes(x = abatement, y = price, color = "red")) +
  geom_line(data = ag_df, aes(x = abatement, y = price, color = "green")) +
  labs(x = "Abatement (Acre Feet)",
       y = " ",
       color = "Sector") +
  theme_minimal() +
  scale_x_continuous(limit = c(0,150)) +
  scale_y_continuous(limit = c(0,150)) +
  scale_color_manual(labels = c("Industrial", "Urban", "Agriculture", "Meat"), values = c("black", "blue", "green", "red"))

# put them together
graph_compound <- (og_data|reg_data) & plot_layout(guides = "collect")

graph_compound
```

## 2. 
### Agriculture
```{r}
ag_df <- data.frame(abatement = seq.int(from = 0, to = 170)) %>% 
  mutate(price = 1.9 + (0.51*abatement)) %>% 
  mutate(quantity = 170 - abatement)

ggplot(data = ag_df, aes(x = quantity,
                         y = price)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Quantity(Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Agriculture Sector Demand for Water Use") +
  ggpubr::stat_regline_equation(label.x = 25, label.y = 5)
```

### Meat
```{r}
meat_df <- data.frame(abatement = seq.int(from = 0, to = 200)) %>% 
  mutate(price = 9.5 + (0.38*abatement)) %>% 
  mutate(quantity = 200 - abatement)

ggplot(data = meat_df, aes(x = quantity,
                         y = price)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Quantity(Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Meat Sector Demand for Water Use") +
  ggpubr::stat_regline_equation(label.x = 25, label.y = 5)
```

### Industrial
```{r}
industrial_df <- data.frame(abatement = seq.int(from = 0, to = 230)) %>% 
  mutate(price = -27 + (1.1*abatement)) %>% 
  mutate(quantity = 230 - abatement)

ggplot(data = industrial_df, aes(x = quantity,
                                 y = price)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Quantity(Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Industrial Sector Demand for Water Use") +
  ggpubr::stat_regline_equation(label.x = 25, label.y = 5)
```

### Urban
```{r}
urban_df <- data.frame(abatement = seq.int(from = 0, to = 300)) %>% 
  mutate(price = -14 + (0.6*abatement)) %>% 
  mutate(quantity = 300 - abatement)

ggplot(data = urban_df, aes(x = quantity,
                         y = price)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Quantity(Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Urban Sector Demand for Water Use") +
  ggpubr::stat_regline_equation(label.x = 25, label.y = 5)
```


The industrial sector is willing to pay the most ($230) for the first acre foot of water. 

## 3. Baja California: Agriculture, Meat, and Industrial

### A. Cap on water use (cut 100AF/sector)

#### (1) the total cost of meeting the target in Baja California

$$\int_0^{300} 1.8 + 0.18A$$

```{r}
# demand aggregate for Baja California = demand agriculture + demand industrial + demand meat

# demand agriculture: P = 89 - 0.51 Q --> Q = (P-89)/(-0.51)
# demand industrial: P = 230 - 1.1 Q --> Q = (P - 230)/(-1.1)
# demand meat: P = 86 - 0.38 Q --> Q = (P - 86)/(-0.38)

# demand aggregate: P = (Q - 609.92)/(-5.50)

baja_tot_df <- data.frame(quantity = seq.int(from = 0, to = 600)) %>% 
  mutate(price = (quantity - 609.92)/(-5.50)) %>% 
  mutate(abatement = 600 - quantity)

ggplot(data = baja_tot_df, aes(x = abatement,
                               y = price)) +
  geom_line() +
  theme_minimal() +
  ggpubr::stat_regline_equation(label.x = 25, label.y = 5)

ggplot(data = baja_tot_df, aes(x = quantity,
                               y = price)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Quantity(Acre Feet)",
       y = "Price ($/Acre Feet)",
       title = "Baja California Demand for Water Use") +
  ggpubr::stat_regline_equation(label.x = 25, label.y = 5)

p_tot <- function(A) {1.8 + (0.18*A)}
integrate(p_tot, lower = 0, upper = 300)
```

#### (2) the total cost (or benefit) to each sector

Agriculture Sector Cost

$$\int_0^{100} 1.9 + 0.51A$$
```{r}
p_ag <- function(A) {1.9 + (0.51*A)}
integrate(p_ag, lower = 0, upper = 100)
```

Meat Sector Cost

$$\int_0^{100} 9.5 + 0.38A$$
```{r}
p_meat <- function(A) {9.5 + (0.38*A)}
integrate(p_meat, lower = 0, upper = 100)
```

Industrial Sector Cost

$$\int_0^{100} -27 + 1.1A$$
```{r}
p_industrial <- function(A) {-27 + (1.1*A)}
integrate(p_industrial, lower = 0, upper = 100)
```


#### (3) the tax revenue generated

There is no tax revenue generated when a cap is put on pollution because no taxes have been implemented. 


### B. Tax on water use

#### (1) the total cost of meeting the target in Baja California


#### (2) the total cost (or benefit) to each sector

Agriculture Sector Cost
```{r}

```

#### (3) the tax revenue generated

### C. Water Cap and Trade

#### (1) the total cost of meeting the target in Baja California
```{r}
cap_and_trade <- merge(meat_df, ag_df, by = "abatement") %>% 
  rename("price_meat" = "price.x") %>%
  rename("quantity_meat" = "quantity.x") %>% 
  rename("price_agriculture" = "price.y") %>% 
  rename("quantity_agriculture" = "quantity.y") 

cap_and_trade_3 <- merge(cap_and_trade, industrial_df, by = "abatement") %>% 
  rename("price_industrial" = "price") %>% 
  rename("quantity_industrial" = "quantity") %>% 
  select(abatement, price_meat, price_agriculture, price_industrial)

ggplot() +
  geom_line(data = cap_and_trade_3, aes(x = abatement,
                                        y = price_industrial),
                                        color = "black") +
  geom_line(data = cap_and_trade_3, aes(x = abatement,
                                        y = price_meat),
                                        color = "red") +
  geom_line(data = cap_and_trade_3, aes(x = abatement,
                                        y = price_agriculture),
                                        color = "green") +
  theme_minimal() +
  scale_y_continuous(limits = c(0,150)) +
  geom_hline(yintercept = 56.24)
```

#### (2) the total cost (or benefit) to each sector
#### (3) the tax revenue generated
